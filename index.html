<html>
<head>
<script src="bower_components/flocking/dist/flocking-all.js"></script>
<style>
input{
	z-index: 10;
	width: 50%;
	position:fixed;
	top: 50%;
	left: 25%;
}
.code {
	position:absolute;
    opacity: 0.5;
}
.code:hover{
    opacity:1.0;
    transition: opacity .15s ease-in-out
}
#result{
    position: fixed;
    top: 55%;
    left:25%;
    width: 50%;
    text-align: center;
}
</style>
</head>
<body>

    <input type="text" id="console" onKeyPress="runcode(event)">
    <div id="count"></div>
    <div id="result"></div>
    <script>
        var code = [];
        /*if (confirm("Would you like to load code?")){
            loadCode(); 
        }*/
        $("#count").html(code.length);

        function storecode(){
            var showcount = document.getElementById("count");
            showcount.innerHTML = code.length;

            localStorage['flork-'+code.length] = document.getElementById("console").value;	    
        };

        function runcode(e){
            if(e.keyCode === 13) {

                // if console is a number then show that code
                // if console is a number with () then run that line

                switch (document.getElementById("console").value ){
                    case 'clear()':
                        clearCode();
                        $("#result").show().html("organizing").fadeOut(3000);
                        break;
                    case 'last':
                        $("#result").show().html(code[code.length-1]).fadeOut(3000);
                        break;
                    case 'last()':
                        // run the last command
                        break;
                    case 'load()':
                        loadCode();
                        break;
                    case 'scatter()':
                        scatter();
                        $("#result").show().html("look out").fadeOut(3000);
                        break;
                    case 'organize()':
                         organize();
                        $("#result").show().html("organizing").fadeOut(3000);
                        break;
                    default:  
                        try{
                            eval( $('#console').val()     );
                        }catch(err){
                            $("#result").show().html("nope").fadeOut(3000);
                            document.getElementById("console").value = "";
                            return;// not the best solution
                        }
                        createNewCodeDiv( $('#console').val() );
                        storecode();	
                        break; 
                }
                document.getElementById("console").value = "";
            } 
            ///////// else if e.keyCode === ESC then show midi overlay
            ////////
        };


        function clearCode(){
                for(var i = 0; localStorage.getItem("flork-"+i) !== null; i++){
                    localStorage.removeItem("flork-"+i);
                }
        };

        function loadCode(){
                for(var i = 0; localStorage.getItem("flork-"+i) !== null; i++){
                    var storageItem = localStorage.getItem("flork-"+i);
                    createNewCodeDiv( storageItem );
                    code[i] = storageItem;
                }
        };

        function createNewCodeDiv(content){
                var newdiv = document.createElement("div");	
                newdiv.innerHTML = content;
                newdiv.className = "code";
                newdiv.onclick = function(){
                    $("#console").val(this.innerHTML);
                    $("#console").focus();
                };
                newdiv.style.top = Math.random() * window.innerHeight;
                newdiv.style.left= Math.random() * window.innerWidth;
                document.body.appendChild(newdiv);
        };

        //-------------------------------------
        //  functions to move code divs around the screen
        //-------------------------------------
        function scatter(){
            $(".code").each(function(){
                $(this).animate({top:Math.random()*window.innerHeight,left:Math.random()*window.innerWidth},'fast');
            });
        }

        function organize(){
            $(".code").each(function(index){
                $(this).animate({top:20*index,left:0.9*window.innerWidth},'fast');
            });
        }
    </script>
</body>
</html>
